<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>GameStore</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Inter:wght@400;500;600&display=swap');
:root{--bg:#09090f;--bg2:#0f0f1a;--bg3:#161625;--card:#121220;--border:#22223a;--accent:#7c3aed;--accent2:#a855f7;--glow:rgba(124,58,237,.28);--gold:#f59e0b;--green:#10b981;--red:#ef4444;--text:#f0f0fa;--text2:#8080a0;--text3:#404060;--r:16px}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;padding-bottom:82px}
.hdr{background:rgba(9,9,15,.96);backdrop-filter:blur(18px);border-bottom:1px solid var(--border);padding:13px 16px 0;position:sticky;top:0;z-index:100}
.hdr-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:11px}
.logo{font-family:'Rajdhani',sans-serif;font-size:21px;font-weight:700;letter-spacing:3px;background:linear-gradient(90deg,#c084fc,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.logo em{-webkit-text-fill-color:var(--gold);font-style:normal}
.cart-ico{background:var(--bg3);border:1px solid var(--border);border-radius:11px;padding:7px 11px;font-size:17px;cursor:pointer;transition:.15s;position:relative}
.cart-ico:active{transform:scale(.9)}
.cbadge{position:absolute;top:-5px;right:-5px;background:var(--red);color:#fff;font-size:9px;font-weight:700;width:16px;height:16px;border-radius:50%;display:none;align-items:center;justify-content:center}
.cbadge.v{display:flex}
.htabs{display:flex;gap:6px;overflow-x:auto;scrollbar-width:none;padding-bottom:10px}
.htabs::-webkit-scrollbar{display:none}
.htab{flex-shrink:0;padding:6px 13px;background:var(--bg3);border:1px solid var(--border);border-radius:20px;font-size:12px;font-weight:500;color:var(--text2);cursor:pointer;transition:.2s;white-space:nowrap}
.htab.on{background:var(--accent);border-color:var(--accent);color:#fff;box-shadow:0 0 14px var(--glow)}
.page{display:none}.page.on{display:block}
.home-hero{margin:14px 14px 0;background:linear-gradient(135deg,#1e0a48,#0c1038 55%,#091828);border:1px solid #2a185a;border-radius:20px;padding:22px 20px;position:relative;overflow:hidden}
.home-hero::before{content:'';position:absolute;top:-70px;right:-50px;width:220px;height:220px;background:radial-gradient(circle,rgba(124,58,237,.38),transparent 70%);border-radius:50%;pointer-events:none}
.hero-tag{display:inline-block;background:linear-gradient(90deg,#f59e0b,#f97316);color:#000;font-size:10px;font-weight:700;padding:3px 10px;border-radius:20px;margin-bottom:10px}
.home-hero h2{font-family:'Rajdhani',sans-serif;font-size:25px;font-weight:700;line-height:1.2;margin-bottom:8px;background:linear-gradient(135deg,#fff 40%,#c4b5fd);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.home-hero p{font-size:12px;color:var(--text2);line-height:1.65}
.hero-chips{display:flex;gap:6px;margin-top:12px;flex-wrap:wrap}
.chip{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);border-radius:20px;padding:4px 10px;font-size:11px;color:var(--text2)}
.home-stats{display:flex;gap:8px;padding:14px 14px 0}
.hstat{flex:1;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px 10px;text-align:center}
.hstat-val{font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700;color:var(--accent2)}
.hstat-lbl{font-size:10px;color:var(--text2);margin-top:2px}
.feat-scroll{display:flex;gap:10px;overflow-x:auto;scrollbar-width:none;padding:0 14px}
.feat-scroll::-webkit-scrollbar{display:none}
.feat-card{flex-shrink:0;width:135px;background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:14px 12px;cursor:pointer;transition:.15s}
.feat-card:active{transform:scale(.95);border-color:var(--accent)}
.fc-emoji{font-size:32px;margin-bottom:8px;display:block}
.fc-name{font-size:12px;font-weight:600;margin-bottom:4px;line-height:1.3}
.fc-price{font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:700;color:var(--accent2)}
.hiw{margin:14px;background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:16px}
.hiw-title{font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:700;margin-bottom:12px}
.hiw-step{display:flex;align-items:flex-start;gap:12px;margin-bottom:10px}
.hiw-step:last-child{margin-bottom:0}
.step-num{background:var(--accent);color:#fff;font-size:11px;font-weight:700;width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px}
.step-text{font-size:13px;line-height:1.5;color:var(--text2)}
.step-text b{color:var(--text)}
.cat-page{padding:14px}
.cat-page-title{font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700;margin-bottom:14px}
.cat-block{margin-bottom:22px}
.cat-block-head{display:flex;align-items:center;gap:8px;margin-bottom:10px}
.cat-block-title{font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:700}
.cat-block-count{font-size:11px;color:var(--text2);background:var(--bg3);border:1px solid var(--border);padding:3px 9px;border-radius:20px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.gcard{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:14px 12px;cursor:pointer;transition:.18s;position:relative;overflow:hidden}
.gcard:active{transform:scale(.96);border-color:var(--accent)}
.gcard-emoji{font-size:34px;margin-bottom:8px;display:block}
.gcard-name{font-size:13px;font-weight:600;margin-bottom:2px}
.gcard-sub{font-size:11px;color:var(--text2)}
.gcard-badge{position:absolute;top:9px;right:9px;font-size:9px;font-weight:700;padding:2px 7px;border-radius:20px}
.bh{background:var(--red);color:#fff}.bn{background:var(--green);color:#fff}
.items-page{padding:14px}
.back-btn{display:flex;align-items:center;gap:6px;width:fit-content;cursor:pointer;font-size:13px;color:var(--text2);background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:7px 12px;margin-bottom:14px}
.back-btn:active{transform:scale(.95)}
.items-header{background:linear-gradient(135deg,var(--bg3),var(--card));border:1px solid var(--border);border-radius:var(--r);padding:18px;text-align:center;margin-bottom:14px}
.ih-emoji{font-size:52px;margin-bottom:10px;display:block;filter:drop-shadow(0 0 14px rgba(168,85,247,.35))}
.ih-name{font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;margin-bottom:4px}
.ih-desc{font-size:13px;color:var(--text2);line-height:1.5}
.prod-list{display:flex;flex-direction:column;gap:8px}
.prow{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:.15s}
.prow:active{background:var(--bg3)}
.pr-left{flex:1;min-width:0}
.pr-name{font-size:14px;font-weight:600;margin-bottom:2px}
.pr-sub{font-size:12px;color:var(--text2)}
.pr-right{text-align:right;flex-shrink:0}
.pr-price{font-family:'Rajdhani',sans-serif;font-size:19px;font-weight:700}
.pr-old{font-size:10px;color:var(--text3);text-decoration:line-through}
.pr-disc{font-size:10px;color:var(--green);font-weight:600}
.det-head{background:linear-gradient(160deg,var(--bg3),var(--card));border-bottom:1px solid var(--border);padding:20px 16px 22px;text-align:center}
.det-emoji{font-size:68px;margin-bottom:12px;display:block;filter:drop-shadow(0 0 18px rgba(168,85,247,.4))}
.det-name{font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;margin-bottom:4px}
.det-cat{font-size:13px;color:var(--text2);margin-bottom:16px}
.price-row{display:flex;align-items:center;justify-content:center;gap:10px}
.det-price{font-family:'Rajdhani',sans-serif;font-size:32px;font-weight:700;color:var(--accent2)}
.det-old{font-size:16px;color:var(--text3);text-decoration:line-through}
.det-disc{background:var(--red);color:#fff;font-size:11px;font-weight:700;padding:3px 9px;border-radius:20px}
.det-body{padding:16px 14px}
.feats{background:var(--card);border:1px solid var(--border);border-radius:var(--r);margin-bottom:12px}
.frow{display:flex;align-items:flex-start;gap:10px;padding:12px 14px;border-bottom:1px solid var(--border);font-size:13px;line-height:1.5}
.frow:last-child{border-bottom:none}
.frow .ico{font-size:17px;flex-shrink:0;margin-top:1px}
.promo-block{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:14px;margin-bottom:12px}
.promo-label{font-size:13px;font-weight:600;margin-bottom:10px}
.promo-row{display:flex;gap:8px}
.promo-input{flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:14px;color:var(--text);outline:none;transition:border .2s;text-transform:uppercase;font-family:'Inter',sans-serif}
.promo-input:focus{border-color:var(--accent)}
.promo-input::placeholder{color:var(--text3);text-transform:none}
.promo-apply{background:var(--accent);border:none;border-radius:10px;padding:10px 16px;font-size:13px;font-weight:600;color:#fff;cursor:pointer;white-space:nowrap;font-family:'Inter',sans-serif}
.promo-apply:active{transform:scale(.95)}
.promo-status{margin-top:8px;font-size:12px;display:none;line-height:1.5}
.promo-ok{color:var(--green)}.promo-err{color:var(--red)}
.pay-opts{background:var(--card);border:1px solid var(--border);border-radius:var(--r);margin-bottom:12px;overflow:hidden}
.pay-title{font-size:13px;font-weight:600;padding:12px 14px;border-bottom:1px solid var(--border)}
.pay-methods{display:flex}
.pay-m{flex:1;display:flex;flex-direction:column;align-items:center;gap:5px;padding:14px 8px;cursor:pointer;transition:.15s;border-right:1px solid var(--border);font-size:12px;font-weight:500;color:var(--text2)}
.pay-m:last-child{border-right:none}
.pay-m.sel{background:rgba(124,58,237,.12);color:var(--accent2)}
.pay-m:active{transform:scale(.95)}
.pay-ico{font-size:22px}
.btn-primary{width:100%;background:linear-gradient(135deg,#7c3aed,#a855f7);border:none;border-radius:var(--r);padding:16px;font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700;letter-spacing:1.5px;color:#fff;cursor:pointer;box-shadow:0 4px 22px rgba(124,58,237,.42);transition:.15s;margin-bottom:8px;display:block}
.btn-primary:active{transform:scale(.98)}
.btn-secondary{width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:var(--r);padding:14px;font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:600;color:var(--text2);cursor:pointer;display:block}
.btn-secondary:active{transform:scale(.98)}
.cart-page{padding:14px}
.cart-title{font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700;margin-bottom:14px}
.cart-empty{text-align:center;padding:60px 20px}
.cart-empty-icon{font-size:60px;opacity:.25;margin-bottom:14px}
.cart-empty p{color:var(--text2);font-size:14px}
.ci{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:13px;display:flex;align-items:center;gap:10px;margin-bottom:8px}
.ci-emoji{font-size:26px;flex-shrink:0}
.ci-info{flex:1;min-width:0}
.ci-name{font-size:13px;font-weight:600;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ci-price{font-size:13px;color:var(--accent2);font-weight:600}
.ci-actions{display:flex;gap:6px;flex-shrink:0}
.ci-buy-btn{background:rgba(124,58,237,.15);border:1px solid rgba(124,58,237,.3);border-radius:8px;padding:7px 10px;color:var(--accent2);font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap;font-family:'Inter',sans-serif}
.ci-del-btn{background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.25);border-radius:8px;padding:7px 10px;color:var(--red);font-size:14px;cursor:pointer}
.ci-del-btn:active,.ci-buy-btn:active{transform:scale(.9)}
.cart-promo{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:10px}
.cart-promo-title{font-size:13px;font-weight:600;margin-bottom:10px}
.cart-sep{height:1px;background:var(--border);margin:10px 0}
.cart-tot{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 16px;margin-bottom:12px}
.tot-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.tot-row:last-child{margin-bottom:0}
.tot-lbl{font-size:13px;color:var(--text2)}
.tot-val{font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:700}
.tot-row.final .tot-lbl{font-size:15px;font-weight:600;color:var(--text)}
.tot-row.final .tot-val{font-size:24px;color:var(--accent2)}
.pay-info-box{background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.2);border-radius:12px;padding:12px 14px;font-size:12px;color:var(--green);margin-bottom:12px;line-height:1.6}
.prof-page{padding:14px}
.prof-card{background:linear-gradient(135deg,#1a0a38,#0a1030,#0a1820);border:1px solid #2a1a5a;border-radius:20px;padding:24px;text-align:center;margin-bottom:12px;position:relative;overflow:hidden}
.prof-card::before{content:'';position:absolute;top:-50px;left:50%;transform:translateX(-50%);width:180px;height:180px;background:radial-gradient(circle,rgba(124,58,237,.28),transparent 70%);pointer-events:none}
.prof-ava{width:66px;height:66px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:27px;margin:0 auto 10px;box-shadow:0 4px 18px var(--glow)}
.prof-name{font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;margin-bottom:8px}
.prof-status{display:inline-block;background:rgba(245,158,11,.15);border:1px solid rgba(245,158,11,.3);color:var(--gold);font-size:12px;font-weight:600;padding:4px 12px;border-radius:20px}
.stats3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.sbox{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 8px;text-align:center}
.sb-v{font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700;color:var(--accent2)}
.sb-l{font-size:10px;color:var(--text2);margin-top:3px}
.ref-block{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:16px;margin-bottom:12px}
.ref-ttl{font-size:14px;font-weight:600;margin-bottom:6px}
.ref-desc{font-size:12px;color:var(--text2);margin-bottom:10px;line-height:1.5}
.ref-link-row{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:11px 12px;display:flex;align-items:center;gap:10px;cursor:pointer}
.ref-link-txt{flex:1;font-size:12px;color:var(--text2);word-break:break-all}
.ref-copy-btn{background:var(--accent);border:none;border-radius:8px;padding:7px 12px;color:#fff;font-size:12px;font-weight:600;cursor:pointer;flex-shrink:0;font-family:'Inter',sans-serif}
.ref-copy-btn:active{transform:scale(.93)}
.bnav{position:fixed;bottom:0;left:0;right:0;background:rgba(9,9,15,.97);backdrop-filter:blur(20px);border-top:1px solid var(--border);display:flex;z-index:200;padding:8px 0 18px}
.bi{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;transition:.15s}
.bi:active{transform:scale(.88)}
.bi-icon{font-size:21px}
.bi-lbl{font-size:10px;color:var(--text3);font-weight:500}
.bi.on .bi-lbl{color:var(--accent2)}
.bi.on .bi-icon{filter:drop-shadow(0 0 7px var(--accent2))}
.toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%) translateY(14px);background:var(--green);color:#fff;padding:10px 20px;border-radius:20px;font-size:13px;font-weight:600;opacity:0;transition:.25s;z-index:999;white-space:nowrap;pointer-events:none}
.toast.v{opacity:1;transform:translateX(-50%) translateY(0)}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.au{animation:fadeUp .28s ease}
.sec-title{font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:700;margin-bottom:10px}
.mt14{margin-top:14px}.ph14{padding:0 14px}
.empty-s{text-align:center;padding:36px 20px;color:var(--text2);font-size:14px}
</style>
</head>
<body>

<div class="hdr" id="hdr">
  <div class="hdr-top">
    <div class="logo">GAME<em>‚Ä¢</em>STORE</div>
    <div class="cart-ico" id="btnCartIco">üõí<div class="cbadge" id="cbadge">0</div></div>
  </div>
  <div class="htabs" id="htabs" style="display:none">
    <div class="htab on" data-t="all">üî• –í—Å–µ</div>
    <div class="htab" data-t="games">üéÆ –ò–≥—Ä—ã</div>
    <div class="htab" data-t="ai">ü§ñ AI</div>
    <div class="htab" data-t="stream">üéµ –ú—É–∑—ã–∫–∞</div>
  </div>
</div>

<div class="page on" id="page-home">
  <div class="home-hero au">
    <div class="hero-tag">üî• –°–ö–ò–î–ö–ò –î–û 30%</div>
    <h2>–ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞<br>–∏ –ø–æ–¥–ø–∏—Å–∫–∏</h2>
    <p>–û–ø–ª–∞—Ç–∞ –°–ë–ü –∏ –∫–∞—Ä—Ç–æ–π –†–§ ¬∑ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ ¬∑ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7</p>
    <div class="hero-chips">
      <div class="chip">üí≥ –°–ë–ü</div>
      <div class="chip">üè¶ –ö–∞—Ä—Ç–∞ –†–§</div>
      <div class="chip">‚ö° –ê–≤—Ç–æ–≤—ã–¥–∞—á–∞</div>
      <div class="chip">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥—ã</div>
    </div>
  </div>
  <div class="home-stats au">
    <div class="hstat"><div class="hstat-val">500+</div><div class="hstat-lbl">–ó–∞–∫–∞–∑–æ–≤</div></div>
    <div class="hstat"><div class="hstat-val">4.9‚òÖ</div><div class="hstat-lbl">–†–µ–π—Ç–∏–Ω–≥</div></div>
    <div class="hstat"><div class="hstat-val">24/7</div><div class="hstat-lbl">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div></div>
  </div>
  <div class="ph14 mt14 au"><div class="sec-title">üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</div></div>
  <div class="feat-scroll au" id="featScroll"></div>
  <div class="hiw au" style="margin-top:14px">
    <div class="hiw-title">‚ö° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</div>
    <div class="hiw-step"><div class="step-num">1</div><div class="step-text"><b>–í—ã–±–µ—Ä–∏ —Ç–æ–≤–∞—Ä</b> –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –∏ –Ω–∞–∂–º–∏ ¬´–ö—É–ø–∏—Ç—å¬ª</div></div>
    <div class="hiw-step"><div class="step-num">2</div><div class="step-text"><b>–û–ø–ª–∞—Ç–∏</b> —á–µ—Ä–µ–∑ –°–ë–ü –∏–ª–∏ –∫–∞—Ä—Ç—É –†–§</div></div>
    <div class="hiw-step"><div class="step-num">3</div><div class="step-text"><b>–ü–æ–ª—É—á–∏ –∫–æ–¥</b> –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã</div></div>
  </div>
</div>

<div class="page" id="page-catalog">
  <div class="cat-page au">
    <div class="cat-page-title">üì¶ –ö–∞—Ç–∞–ª–æ–≥</div>
    <div id="catContent"></div>
  </div>
</div>

<div class="page" id="page-items">
  <div class="items-page au">
    <div class="back-btn" id="btnItemsBack">‚Üê –ù–∞–∑–∞–¥</div>
    <div id="itemsHeader"></div>
    <div class="prod-list" id="itemsList"></div>
  </div>
</div>

<div class="page" id="page-detail">
  <div id="detailContent"></div>
</div>

<div class="page" id="page-cart">
  <div class="cart-page">
    <div class="cart-title">üõí –ö–æ—Ä–∑–∏–Ω–∞</div>
    <div id="cartContent"></div>
  </div>
</div>

<div class="page" id="page-profile">
  <div class="prof-page" id="profContent"></div>
</div>

<div class="bnav">
  <div class="bi on" id="bi-home" data-page="home"><div class="bi-icon">üè†</div><div class="bi-lbl">–ì–ª–∞–≤–Ω–∞—è</div></div>
  <div class="bi" id="bi-catalog" data-page="catalog"><div class="bi-icon">üì¶</div><div class="bi-lbl">–ö–∞—Ç–∞–ª–æ–≥</div></div>
  <div class="bi" id="bi-cart" data-page="cart"><div class="bi-icon">üõí</div><div class="bi-lbl">–ö–æ—Ä–∑–∏–Ω–∞</div></div>
  <div class="bi" id="bi-profile" data-page="profile"><div class="bi-icon">üë§</div><div class="bi-lbl">–ü—Ä–æ—Ñ–∏–ª—å</div></div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TELEGRAM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const tg = window.Telegram?.WebApp;
if (tg) { tg.expand(); tg.setHeaderColor('#09090f'); tg.setBackgroundColor('#09090f'); }
const TG_USER = tg?.initDataUnsafe?.user || { first_name: '–ì–æ—Å—Ç—å', id: 0 };
const BOT = 'gamestoren_bot';

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const DATA = {
  games: [
    { key:'fortnite', name:'Fortnite', currency:'V-Bucks', emoji:'‚ö°', badge:'–•–ò–¢', btype:'bh',
      desc:'–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞ Fortnite. –¢—Ä–∞—Ç—å –Ω–∞ —Å–∫–∏–Ω—ã, —ç–º–æ—Ü–∏–∏ –∏ –±–æ–µ–≤–æ–π –ø—Ä–æ–ø—É—Å–∫.',
      items:[
        { id:101, name:'1 000 V-Bucks',  price:2199,  old:2999,  info:'' },
        { id:102, name:'2 800 V-Bucks',  price:5999,  old:7999,  info:'+ –±–æ–Ω—É—Å 300 V-Bucks' },
        { id:103, name:'5 000 V-Bucks',  price:10499, old:13999, info:'+ –±–æ–Ω—É—Å 500 V-Bucks' },
        { id:104, name:'13 500 V-Bucks', price:27999, old:34999, info:'+ –±–æ–Ω—É—Å 500 V-Bucks' },
      ]
    },
    { key:'brawl', name:'Brawl Stars', currency:'Gems', emoji:'üíé', badge:'', btype:'',
      desc:'–ö—Ä–∏—Å—Ç–∞–ª–ª—ã Brawl Stars. –ü–æ–∫—É–ø–∞–π —Å–∫–∏–Ω—ã, Brawl Pass –∏ –±–æ–∫—Å—ã.',
      items:[
        { id:201, name:'80 Gems',  price:1099,  old:1499,  info:'' },
        { id:202, name:'170 Gems', price:2199,  old:2999,  info:'' },
        { id:203, name:'360 Gems', price:4499,  old:5999,  info:'' },
        { id:204, name:'950 Gems', price:10999, old:13999, info:'–°–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –ø–∞–∫' },
      ]
    },
  ],
  ai: [
    { key:'chatgpt', name:'ChatGPT Plus', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'ü§ñ', badge:'–•–ò–¢', btype:'bh',
      desc:'GPT-4o, DALL-E 3, –∞–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–æ–≤. –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è.',
      items:[{ id:1001, name:'ChatGPT Plus ‚Äî 1 –º–µ—Å—è—Ü', price:1999, old:2599, info:'GPT-4o ¬∑ DALL-E 3 ¬∑ –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤' }]
    },
    { key:'claude', name:'Claude Pro', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'üß†', badge:'', btype:'',
      desc:'Claude 3.5 Sonnet –±–µ–∑ —Å—É—Ç–æ—á–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤. –õ—É—á—à–∏–π AI –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –∏ –∫–æ–¥–∞.',
      items:[{ id:1101, name:'Claude Pro ‚Äî 1 –º–µ—Å—è—Ü', price:1899, old:2499, info:'Claude 3.5 ¬∑ –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤' }]
    },
    { key:'midj', name:'Midjourney', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'üé®', badge:'', btype:'',
      desc:'–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ —Ç–µ–∫—Å—Ç—É. –õ—É—á—à–∏–π AI –¥–ª—è –∞—Ä—Ç–∞ –∏ –¥–∏–∑–∞–π–Ω–∞.',
      items:[
        { id:1201, name:'Midjourney Basic ‚Äî 1 –º–µ—Å—è—Ü',    price:1299, old:1699, info:'200 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π ¬∑ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ' },
        { id:1202, name:'Midjourney Standard ‚Äî 1 –º–µ—Å—è—Ü', price:2199, old:2899, info:'–ë–µ–∑ –ª–∏–º–∏—Ç–∞ ¬∑ Relax —Ä–µ–∂–∏–º' },
      ]
    },
    { key:'grok', name:'Grok Premium', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'‚ú¶', badge:'NEW', btype:'bn',
      desc:'AI –æ—Ç xAI. Grok-2, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π Aurora, DeepSearch.',
      items:[{ id:1301, name:'Grok Premium ‚Äî 1 –º–µ—Å—è—Ü', price:1799, old:2299, info:'Grok-2 ¬∑ Aurora ¬∑ DeepSearch' }]
    },
    { key:'perp', name:'Perplexity Pro', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'üîç', badge:'', btype:'',
      desc:'AI-–ø–æ–∏—Å–∫–æ–≤–∏–∫ —Å –≤—ã—Ö–æ–¥–æ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. GPT-4o, Claude –∏ Grok –≤–Ω—É—Ç—Ä–∏.',
      items:[{ id:1401, name:'Perplexity Pro ‚Äî 1 –º–µ—Å—è—Ü', price:1599, old:2099, info:'–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è ¬∑ GPT-4o ¬∑ Claude' }]
    },
    { key:'copilot', name:'GitHub Copilot', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'üêô', badge:'', btype:'',
      desc:'AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤. –†–∞–±–æ—Ç–∞–µ—Ç –≤ VS Code, JetBrains, Neovim.',
      items:[{ id:1501, name:'GitHub Copilot ‚Äî 1 –º–µ—Å—è—Ü', price:1099, old:1499, info:'VS Code ¬∑ JetBrains ¬∑ Neovim' }]
    },
    { key:'cursor', name:'Cursor Pro', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'üñ±Ô∏è', badge:'NEW', btype:'bn',
      desc:'AI-—Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞. –ü–∏—à–µ—Ç —Ü–µ–ª—ã–µ —Ñ–∞–π–ª—ã, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç –∏ –æ–±—ä—è—Å–Ω—è–µ—Ç –∫–æ–¥.',
      items:[{ id:1601, name:'Cursor Pro ‚Äî 1 –º–µ—Å—è—Ü', price:1799, old:2399, info:'GPT-4o ¬∑ Claude ¬∑ –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤' }]
    },
    { key:'canva', name:'Canva Pro', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'‚úèÔ∏è', badge:'', btype:'',
      desc:'–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω. –í—Å–µ —à–∞–±–ª–æ–Ω—ã, —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞, Brand Kit.',
      items:[
        { id:1701, name:'Canva Pro ‚Äî 1 –º–µ—Å—è—Ü',  price:799,  old:1099, info:'–í—Å–µ —à–∞–±–ª–æ–Ω—ã ¬∑ AI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã' },
        { id:1702, name:'Canva Pro ‚Äî 3 –º–µ—Å—è—Ü–∞', price:1999, old:2999, info:'–í—ã–≥–æ–¥–∞ 30%' },
      ]
    },
    { key:'adobe', name:'Adobe CC', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'üÖ∞Ô∏è', badge:'', btype:'',
      desc:'Photoshop, Illustrator, Premiere, After Effects –∏ 20+ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.',
      items:[{ id:1801, name:'Adobe Creative Cloud ‚Äî 1 –º–µ—Å—è—Ü', price:2999, old:3999, info:'20+ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ¬∑ Photoshop ¬∑ Premiere' }]
    },
  ],
  stream: [
    { key:'spotify', name:'Spotify Premium', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'üéµ', badge:'', btype:'',
      desc:'–ú—É–∑—ã–∫–∞ –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã, –æ—Ñ—Ñ–ª–∞–π–Ω, –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞.',
      items:[
        { id:2001, name:'Spotify Premium ‚Äî 1 –º–µ—Å—è—Ü',  price:449,  old:599,  info:'–ë–µ–∑ —Ä–µ–∫–ª–∞–º—ã ¬∑ –æ—Ñ—Ñ–ª–∞–π–Ω' },
        { id:2002, name:'Spotify Premium ‚Äî 3 –º–µ—Å—è—Ü–∞', price:1099, old:1599, info:'–í—ã–≥–æ–¥–∞ 22%' },
      ]
    },
    { key:'yt', name:'YouTube Premium', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'‚ñ∂Ô∏è', badge:'–•–ò–¢', btype:'bh',
      desc:'YouTube –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã, —Ñ–æ–Ω–æ–≤–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏ YouTube Music.',
      items:[
        { id:2101, name:'YouTube Premium ‚Äî 1 –º–µ—Å—è—Ü',  price:499,  old:699,  info:'–ë–µ–∑ —Ä–µ–∫–ª–∞–º—ã ¬∑ —Ñ–æ–Ω–æ–≤—ã–π —Ä–µ–∂–∏–º ¬∑ YT Music' },
        { id:2102, name:'YouTube Premium ‚Äî 3 –º–µ—Å—è—Ü–∞', price:1299, old:1899, info:'–í—ã–≥–æ–¥–∞ 25%' },
      ]
    },
    { key:'applemus', name:'Apple Music', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'üçé', badge:'', btype:'',
      desc:'100 –º–ª–Ω —Ç—Ä–µ–∫–æ–≤, Dolby Atmos, –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–≤—É–∫.',
      items:[
        { id:2201, name:'Apple Music ‚Äî 1 –º–µ—Å—è—Ü',  price:449,  old:599,  info:'100–ú —Ç—Ä–µ–∫–æ–≤ ¬∑ Dolby Atmos' },
        { id:2202, name:'Apple Music ‚Äî 3 –º–µ—Å—è—Ü–∞', price:1099, old:1599, info:'–í—ã–≥–æ–¥–∞ 22%' },
      ]
    },
    { key:'tidal', name:'Tidal HiFi', currency:'–ü–æ–¥–ø–∏—Å–∫–∞', emoji:'üåä', badge:'NEW', btype:'bn',
      desc:'–ú—É–∑—ã–∫–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä—å (Lossless) –∏ Dolby Atmos.',
      items:[
        { id:2301, name:'Tidal HiFi ‚Äî 1 –º–µ—Å—è—Ü',  price:599,  old:849,  info:'Lossless ¬∑ Dolby Atmos ¬∑ 100–ú —Ç—Ä–µ–∫–æ–≤' },
        { id:2302, name:'Tidal HiFi ‚Äî 3 –º–µ—Å—è—Ü–∞', price:1499, old:2199, info:'–í—ã–≥–æ–¥–∞ 24%' },
      ]
    },
  ]
};

/* flat maps */
const ITEM_MAP = {}, GAME_MAP = {};
Object.values(DATA).flat().forEach(g => {
  GAME_MAP[g.key] = g;
  g.items.forEach(it => { it._g = g; ITEM_MAP[it.id] = it; });
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let cart = [];
let detPromo  = { code:'', discount:0 };
let cartPromo = { code:'', discount:0 };
let selPayDet  = 'sbp';
let selPayCart = 'sbp';
let currentPage = 'home';
let prevPage    = 'catalog';
let activeCat   = 'all';
let currentDetailId = null;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const fmt = n => n.toLocaleString('ru');
const disc = (p, o) => Math.round((1 - p / o) * 100);

function cartSubtotal() { return cart.reduce((s, i) => s + i.price, 0); }
function cartDiscount() { return cartPromo.discount ? Math.round(cartSubtotal() * cartPromo.discount / 100) : 0; }
function cartTotal()    { return cartSubtotal() - cartDiscount(); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let toastTimer;
function showToast(msg, color = '#10b981') {
  const el = document.getElementById('toast');
  el.textContent = msg; el.style.background = color; el.classList.add('v');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('v'), 2500);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CART BADGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updBadge() {
  const el = document.getElementById('cbadge');
  if (cart.length) { el.textContent = cart.length; el.classList.add('v'); }
  else el.classList.remove('v');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROMO VALIDATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const PROMO_ALPHA = new Set('ABCDEFGHJKMNPQRSTUVWXYZ23456789');

function promoLooksValid(code) {
  const m = code.match(/^COSMIC(10|15|20)_([A-Z0-9]{6})$/);
  if (!m) return false;
  return [...m[2]].every(c => PROMO_ALPHA.has(c));
}

function promoDiscount(code) {
  const m = code.match(/^COSMIC(10|15|20)_/);
  return m ? parseInt(m[1]) : 0;
}

function validatePromo(code, statusEl, onOk) {
  code = code.trim().toUpperCase();
  statusEl.style.display = 'block';
  if (!code) {
    statusEl.className = 'promo-status promo-err';
    statusEl.textContent = '‚ùå –í–≤–µ–¥–∏ –ø—Ä–æ–º–æ–∫–æ–¥';
    return;
  }
  if (!promoLooksValid(code)) {
    statusEl.className = 'promo-status promo-err';
    statusEl.textContent = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ü—Ä–∏–º–µ—Ä: COSMIC10_FW1A0Z';
    return;
  }
  const d = promoDiscount(code);
  statusEl.className = 'promo-status promo-ok';
  statusEl.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º...';
  if (tg) tg.sendData(JSON.stringify({ action: 'check_promo', code }));
  setTimeout(() => {
    statusEl.textContent = `‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–Ω—è—Ç ‚Äî —Å–∫–∏–¥–∫–∞ ${d}%!`;
    onOk(code, d);
  }, 700);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE NAVIGATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function goPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
  document.querySelectorAll('.bi').forEach(b => b.classList.remove('on'));
  document.getElementById('page-' + name).classList.add('on');
  const bi = document.getElementById('bi-' + name);
  if (bi) bi.classList.add('on');
  document.getElementById('htabs').style.display = name === 'catalog' ? 'flex' : 'none';
  if (name === 'cart')    renderCart();
  if (name === 'profile') renderProfile();
  if (name === 'catalog') renderCatalog();
  currentPage = name;
  window.scrollTo(0, 0);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CATALOG ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function switchCat(cat) {
  activeCat = cat;
  document.querySelectorAll('.htab').forEach(t => {
    t.classList.toggle('on', t.dataset.t === cat);
  });
  renderCatalog();
}

function renderCatalog() {
  const groups = activeCat === 'all'
    ? [{ label:'üéÆ –ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞', list:DATA.games }, { label:'ü§ñ AI –ø–æ–¥–ø–∏—Å–∫–∏', list:DATA.ai }, { label:'üéµ –ú—É–∑—ã–∫–∞', list:DATA.stream }]
    : activeCat === 'games'  ? [{ label:'üéÆ –ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞', list:DATA.games }]
    : activeCat === 'ai'     ? [{ label:'ü§ñ AI –ø–æ–¥–ø–∏—Å–∫–∏', list:DATA.ai }]
    :                          [{ label:'üéµ –ú—É–∑—ã–∫–∞', list:DATA.stream }];

  document.getElementById('catContent').innerHTML = groups.map(g => `
    <div class="cat-block">
      <div class="cat-block-head">
        <div class="cat-block-title">${g.label}</div>
        <div class="cat-block-count">${g.list.length} –ø–æ–∑–∏—Ü–∏–π</div>
      </div>
      <div class="grid2">${g.list.map(gcHtml).join('')}</div>
    </div>`).join('');

  /* bind game card clicks */
  document.querySelectorAll('.gcard[data-key]').forEach(el => {
    el.addEventListener('click', () => openItems(el.dataset.key));
  });
}

function gcHtml(g) {
  return `<div class="gcard" data-key="${g.key}">
    ${g.badge ? `<div class="gcard-badge ${g.btype}">${g.badge}</div>` : ''}
    <span class="gcard-emoji">${g.emoji}</span>
    <div class="gcard-name">${g.name}</div>
    <div class="gcard-sub">${g.currency}</div>
  </div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ITEMS PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openItems(key) {
  const g = GAME_MAP[key]; if (!g) return;
  prevPage = currentPage;

  document.getElementById('itemsHeader').innerHTML = `
    <div class="items-header">
      <span class="ih-emoji">${g.emoji}</span>
      <div class="ih-name">${g.name}</div>
      <div class="ih-desc">${g.desc}</div>
    </div>`;

  document.getElementById('itemsList').innerHTML = g.items.map(it => `
    <div class="prow" data-id="${it.id}">
      <div class="pr-left">
        <div class="pr-name">${it.name}</div>
        ${it.info ? `<div class="pr-sub">${it.info}</div>` : ''}
      </div>
      <div class="pr-right">
        <div class="pr-price">${fmt(it.price)}‚ÇΩ</div>
        <div class="pr-old">${fmt(it.old)}‚ÇΩ</div>
        <div class="pr-disc">‚àí${disc(it.price, it.old)}%</div>
      </div>
    </div>`).join('');

  document.querySelectorAll('.prow[data-id]').forEach(el => {
    el.addEventListener('click', () => openDetail(+el.dataset.id));
  });

  goPage('items');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DETAIL PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openDetail(id) {
  const it = ITEM_MAP[id]; if (!it) return;
  const g = it._g;
  prevPage = currentPage;
  currentDetailId = id;
  detPromo = { code:'', discount:0 };
  selPayDet = 'sbp';

  const inCart = cart.some(c => c.id === id);
  const d = disc(it.price, it.old);

  document.getElementById('detailContent').innerHTML = `
    <div class="au">
      <div class="det-head">
        <div class="back-btn" id="btnDetBack">‚Üê –ù–∞–∑–∞–¥</div>
        <span class="det-emoji">${g.emoji}</span>
        <div class="det-name">${it.name}</div>
        <div class="det-cat">${g.name} ¬∑ ${g.currency}</div>
        <div class="price-row">
          <div class="det-price" id="detPriceDisplay">${fmt(it.price)}‚ÇΩ</div>
          <div class="det-old">${fmt(it.old)}‚ÇΩ</div>
          <div class="det-disc">‚àí${d}%</div>
        </div>
      </div>
      <div class="det-body">
        ${it.info ? `<div class="feats"><div class="frow"><span class="ico">üìã</span><span>${it.info}</span></div></div>` : ''}
        <div class="feats">
          <div class="frow"><span class="ico">‚ö°</span><span>–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ –∫–æ–¥–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã</span></div>
          <div class="frow"><span class="ico">üîí</span><span>–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Paypalich</span></div>
          <div class="frow"><span class="ico">üí¨</span><span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7 ‚Äî –æ—Ç–≤–µ—Ç–∏–º –∑–∞ 30 –º–∏–Ω—É—Ç</span></div>
          <div class="frow"><span class="ico">‚úÖ</span><span>–ì–∞—Ä–∞–Ω—Ç–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö</span></div>
        </div>
        <div class="promo-block">
          <div class="promo-label">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥ <span style="color:var(--text2);font-weight:400;font-size:12px">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></div>
          <div class="promo-row">
            <input class="promo-input" id="detPromoInput" placeholder="COSMIC10_XXXXXX" maxlength="16">
            <button class="promo-apply" id="btnDetPromo">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
          </div>
          <div class="promo-status" id="detPromoStatus"></div>
        </div>
        <div class="pay-opts">
          <div class="pay-title">üí≥ –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</div>
          <div class="pay-methods">
            <div class="pay-m sel" id="dpm-sbp" data-m="sbp"><div class="pay-ico">üì≤</div><div>–°–ë–ü</div></div>
            <div class="pay-m" id="dpm-card" data-m="card"><div class="pay-ico">üí≥</div><div>–ö–∞—Ä—Ç–∞ –†–§</div></div>
          </div>
        </div>
        <button class="btn-primary" id="btnBuyNow">–ö–£–ü–ò–¢–¨ –ó–ê ${fmt(it.price)}‚ÇΩ</button>
        <button class="btn-secondary" id="btnAddCart">${inCart ? '‚úì –í –∫–æ—Ä–∑–∏–Ω–µ ‚Äî —É–±—Ä–∞—Ç—å' : 'üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É'}</button>
      </div>
    </div>`;

  /* bind all buttons inside detail */
  document.getElementById('btnDetBack').addEventListener('click', () => goPage(prevPage));

  document.querySelectorAll('.pay-m[data-m]').forEach(el => {
    el.addEventListener('click', () => {
      selPayDet = el.dataset.m;
      document.querySelectorAll('.pay-m[data-m]').forEach(e => e.classList.remove('sel'));
      el.classList.add('sel');
    });
  });

  document.getElementById('btnDetPromo').addEventListener('click', () => {
    const code = document.getElementById('detPromoInput').value;
    validatePromo(code, document.getElementById('detPromoStatus'), (c, d) => {
      detPromo = { code: c, discount: d };
      const finalPrice = it.price - Math.round(it.price * d / 100);
      document.getElementById('detPriceDisplay').textContent = `${fmt(finalPrice)}‚ÇΩ`;
      document.getElementById('btnBuyNow').textContent = `–ö–£–ü–ò–¢–¨ –ó–ê ${fmt(finalPrice)}‚ÇΩ (‚àí${d}%)`;
    });
  });

  document.getElementById('btnBuyNow').addEventListener('click', () => {
    const finalPrice = detPromo.discount
      ? it.price - Math.round(it.price * detPromo.discount / 100)
      : it.price;
    if (tg) tg.sendData(JSON.stringify({
      action: 'buy',
      item_id: id,
      item_name: it.name,
      price: it.price,
      final_price: finalPrice,
      promo_code: detPromo.code || '',
      promo_discount: detPromo.discount ? Math.round(it.price * detPromo.discount / 100) : 0,
      pay_method: selPayDet
    }));
    showToast('üîÑ –°–æ–∑–¥–∞—ë–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É...');
  });

  document.getElementById('btnAddCart').addEventListener('click', function() {
    const idx = cart.findIndex(c => c.id === id);
    if (idx !== -1) {
      cart.splice(idx, 1);
      this.textContent = 'üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É';
      updBadge();
      showToast('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã', '#f59e0b');
    } else {
      cart.push({ id, name: it.name, price: it.price, emoji: g.emoji });
      this.textContent = '‚úì –í –∫–æ—Ä–∑–∏–Ω–µ ‚Äî —É–±—Ä–∞—Ç—å';
      updBadge();
      showToast('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!');
    }
  });

  goPage('detail');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CART ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderCart() {
  const el = document.getElementById('cartContent');
  if (!cart.length) {
    el.innerHTML = `<div class="cart-empty"><div class="cart-empty-icon">üõí</div><p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p></div>`;
    return;
  }

  const sub  = cartSubtotal();
  const disc = cartDiscount();
  const tot  = cartTotal();

  const itemsHtml = cart.map((item, i) => `
    <div class="ci">
      <div class="ci-emoji">${item.emoji}</div>
      <div class="ci-info">
        <div class="ci-name">${item.name}</div>
        <div class="ci-price">${fmt(item.price)}‚ÇΩ</div>
      </div>
      <div class="ci-actions">
        <button class="ci-buy-btn" data-ci="${i}">–ö—É–ø–∏—Ç—å</button>
        <button class="ci-del-btn" data-di="${i}">‚úï</button>
      </div>
    </div>`).join('');

  const promoHtml = `
    <div class="cart-promo">
      <div class="cart-promo-title">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</div>
      <div class="promo-row">
        <input class="promo-input" id="cartPromoInput" placeholder="COSMIC10_XXXXXX" value="${cartPromo.code}" maxlength="16">
        <button class="promo-apply" id="btnCartPromo">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      </div>
      <div class="promo-status ${cartPromo.discount ? 'promo-ok' : ''}" id="cartPromoStatus"
           style="display:${cartPromo.discount ? 'block' : 'none'}">
        ${cartPromo.discount ? `‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ ¬´${cartPromo.code}¬ª ‚Äî —Å–∫–∏–¥–∫–∞ ${cartPromo.discount}%` : ''}
      </div>
    </div>`;

  const totHtml = `
    <div class="cart-tot">
      <div class="tot-row"><div class="tot-lbl">–¢–æ–≤–∞—Ä–æ–≤:</div><div class="tot-val">${fmt(sub)}‚ÇΩ</div></div>
      ${disc ? `<div class="tot-row"><div class="tot-lbl" style="color:var(--green)">–°–∫–∏–¥–∫–∞ (${cartPromo.discount}%):</div><div class="tot-val" style="color:var(--green)">‚àí${fmt(disc)}‚ÇΩ</div></div>` : ''}
      <div class="cart-sep"></div>
      <div class="tot-row final"><div class="tot-lbl">–ò—Ç–æ–≥–æ:</div><div class="tot-val">${fmt(tot)}‚ÇΩ</div></div>
    </div>`;

  const payHtml = `
    <div class="pay-opts" style="margin-bottom:12px">
      <div class="pay-title">üí≥ –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</div>
      <div class="pay-methods">
        <div class="pay-m ${selPayCart==='sbp'?'sel':''}" id="cpm-sbp" data-cm="sbp"><div class="pay-ico">üì≤</div><div>–°–ë–ü</div></div>
        <div class="pay-m ${selPayCart==='card'?'sel':''}" id="cpm-card" data-cm="card"><div class="pay-ico">üí≥</div><div>–ö–∞—Ä—Ç–∞ –†–§</div></div>
      </div>
    </div>`;

  el.innerHTML = itemsHtml + promoHtml + totHtml + payHtml +
    `<div class="pay-info-box">üí≥ –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Paypalich ‚Äî –°–ë–ü –∏–ª–∏ –∫–∞—Ä—Ç–∞ –†–§</div>
     <button class="btn-primary" id="btnCheckoutCart">–û–ü–õ–ê–¢–ò–¢–¨ –í–°–Å ‚Äî ${fmt(tot)}‚ÇΩ</button>`;

  /* bind cart buttons */
  document.querySelectorAll('.ci-buy-btn[data-ci]').forEach(btn => {
    btn.addEventListener('click', () => {
      const i = +btn.dataset.ci;
      const item = cart[i]; if (!item) return;
      const finalPrice = cartPromo.discount
        ? item.price - Math.round(item.price * cartPromo.discount / 100) : item.price;
      if (tg) tg.sendData(JSON.stringify({
        action: 'buy', item_id: item.id, item_name: item.name,
        price: item.price, final_price: finalPrice,
        promo_code: cartPromo.code || '',
        promo_discount: cartPromo.discount ? Math.round(item.price * cartPromo.discount / 100) : 0,
        pay_method: selPayCart
      }));
      showToast('üîÑ –°–æ–∑–¥–∞—ë–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É...');
    });
  });

  document.querySelectorAll('.ci-del-btn[data-di]').forEach(btn => {
    btn.addEventListener('click', () => {
      cart.splice(+btn.dataset.di, 1);
      updBadge(); renderCart();
    });
  });

  document.getElementById('btnCartPromo').addEventListener('click', () => {
    const code = document.getElementById('cartPromoInput').value;
    validatePromo(code, document.getElementById('cartPromoStatus'), (c, d) => {
      cartPromo = { code: c, discount: d };
      renderCart();
    });
  });

  document.querySelectorAll('.pay-m[data-cm]').forEach(el => {
    el.addEventListener('click', () => {
      selPayCart = el.dataset.cm;
      document.querySelectorAll('.pay-m[data-cm]').forEach(e => e.classList.remove('sel'));
      el.classList.add('sel');
    });
  });

  document.getElementById('btnCheckoutCart').addEventListener('click', () => {
    if (!tg) return;
    tg.sendData(JSON.stringify({
      action: 'checkout_cart',
      cart: cart.map(c => ({ id: c.id, name: c.name, price: c.price })),
      subtotal: cartSubtotal(),
      discount: cartDiscount(),
      total: cartTotal(),
      promo_code: cartPromo.code || '',
      pay_method: selPayCart
    }));
    showToast('üîÑ –°–æ–∑–¥–∞—ë–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É...');
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderProfile() {
  const ref = `https://t.me/${BOT}?start=REF${TG_USER.id}`;
  document.getElementById('profContent').innerHTML = `
    <div class="prof-card au">
      <div class="prof-ava">üë§</div>
      <div class="prof-name">${TG_USER.first_name}</div>
      <div class="prof-status">ü•â –ù–æ–≤–∏—á–æ–∫</div>
    </div>
    <div class="stats3 au">
      <div class="sbox"><div class="sb-v">0</div><div class="sb-l">–ó–∞–∫–∞–∑–æ–≤</div></div>
      <div class="sbox"><div class="sb-v">0‚ÇΩ</div><div class="sb-l">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</div></div>
      <div class="sbox"><div class="sb-v">0</div><div class="sb-l">–†–µ—Ñ–µ—Ä–∞–ª–æ–≤</div></div>
    </div>
    <div class="ref-block au">
      <div class="ref-ttl">üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</div>
      <div class="ref-desc">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π ‚Äî –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã –∑–∞ –∫–∞–∂–¥–æ–≥–æ!</div>
      <div class="ref-link-row" id="refLinkRow">
        <div class="ref-link-txt">${ref}</div>
        <button class="ref-copy-btn" data-ref="${ref}">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
    </div>
    <div class="sec-title au" style="margin:12px 0 10px">üì¶ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</div>
    <div class="empty-s au">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç üéÆ</div>`;

  document.querySelector('.ref-copy-btn[data-ref]').addEventListener('click', function () {
    navigator.clipboard?.writeText(this.dataset.ref);
    showToast('üîó –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FEATURED (Home) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderFeatured() {
  const picks = [ITEM_MAP[102], ITEM_MAP[1001], ITEM_MAP[204], ITEM_MAP[2101], ITEM_MAP[1101], ITEM_MAP[2001]].filter(Boolean);
  document.getElementById('featScroll').innerHTML = picks.map(it =>
    `<div class="feat-card" data-fid="${it.id}">
      <span class="fc-emoji">${it._g.emoji}</span>
      <div class="fc-name">${it.name}</div>
      <div class="fc-price">${fmt(it.price)}‚ÇΩ</div>
    </div>`).join('');
  document.querySelectorAll('.feat-card[data-fid]').forEach(el => {
    el.addEventListener('click', () => openDetail(+el.dataset.fid));
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BIND STATIC ELEMENTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.addEventListener('DOMContentLoaded', () => {
  /* bottom nav */
  document.querySelectorAll('.bi[data-page]').forEach(el => {
    el.addEventListener('click', () => goPage(el.dataset.page));
  });

  /* cart icon in header */
  document.getElementById('btnCartIco').addEventListener('click', () => goPage('cart'));

  /* catalog tabs */
  document.querySelectorAll('.htab[data-t]').forEach(el => {
    el.addEventListener('click', () => switchCat(el.dataset.t));
  });

  /* items back button */
  document.getElementById('btnItemsBack').addEventListener('click', () => goPage(prevPage));

  /* INIT */
  renderFeatured();
  updBadge();
});
</script>
</body>
</html>
